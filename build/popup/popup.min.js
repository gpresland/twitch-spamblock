// TWITCH SpamBlock
//
// Copyright (c) Year(s), gpresland@gmail.com
// Permission to use, copy, modify, and/or distribute this software for any purpose with
// or without fee is hereby granted, provided that the above copyright notice and this
// permission notice appear in all copies.
//
// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD
// TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN
// NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
// DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER
// IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
// CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
!function(a,b){function c(a){return function(){a.value=document.getElementById("toggle-"+a.name).checked,settings.options[a.name].value=a.value,settings.save(),e()}}function d(){var a,b;a=$("#blockstring").val().trim().toLowerCase(),b=a.split(";").filter(function(a){return a.length>0?a:void 0}),settings.blockstring=b,settings.save(),e()}function e(){chrome.tabs.query({active:!0,currentWindow:!0},function(a){var b=chrome.tabs.connect(a[0].id,{name:"twitch-spamblock"});b.postMessage({options:settings.options,blockstring:settings.blockstring})})}b["true"]=a,settings={},settings.options={allcaps:{name:"allcaps",category:"hide",description:"ALL CAPS",tooltip:"Hide messages in ALL CAPS",value:!1},cleanup:{name:"cleanup",category:"transform",description:"Clean Up",tooltip:"Trim and remove extra whitespace",value:!1},command:{name:"command",category:"hide",description:"Commands",tooltip:"Hide bot commands e.g. !command",value:!1},copypaste:{name:"copypaste",category:"hide",description:"Copy Pastas",tooltip:"Hide repeat copy & paste text",value:!1},custom:{name:"custom",category:"hide",description:"Custom Strings",tooltip:"Block messages containing customs strings below",value:!1},cyrillic:{name:"cyrillic",category:"hide",description:"Cyrillic",tooltip:"Hide Cyrillic (Russian) text",value:!1},debug:{name:"debug",category:"other",description:"Log Hidden to Console",tooltip:"Shows hidden messages in the console",value:!1},donger:{name:"donger",category:"hide",description:"Dongers",tooltip:"Hide dongers i.e. unicode art",value:!1},drawing:{name:"drawing",category:"hide",description:"Drawings",tooltip:"Hide block drawings",value:!1},emotes:{name:"emotes",category:"transform",description:"Remove Emotes",tooltip:"Hide all Twitch emotes",value:!1},"long":{name:"long",category:"hide",description:"Long Messages",tooltip:"Hide long messages",value:!1},lowercase:{name:"lowercase",category:"transform",description:"To Lowercase",tooltip:"Make all messages lowercase",value:!1},"short":{name:"short",category:"hide",description:"Short Messages",tooltip:"Hide short messages",value:!1}},settings.blockstring=[],settings.save=function(){var a,b={options:{},blockstring:settings.blockstring};for(a in settings.options)b.options[a]=settings.options[a].value;chrome.storage.sync.set(b,function(){})},settings.clear=function(){chrome.storage.sync.clear()},settings.load=function(a){chrome.storage.sync.get(null,function(b){var c;for(c in settings.options)b.hasOwnProperty("options")&&"undefined"!=typeof b.options?settings.options[c].value=b.options[c]:settings.options[c].value=!1;b.hasOwnProperty("blockstring")&&(settings.blockstring=b.blockstring),"function"==typeof a&&a({options:settings.options,blockstring:settings.blockstring})})},function(){$(document).ready(function(){settings.load(function(a){var b,e,f,g,h;for(b in a.options)f=a.options[b],h=f.value?'checked="checked"':"",e='<li><div class="option-text" title="'+f.tooltip+'">'+f.description+'<div class="option-controls"><div class="switch"><input id="toggle-'+f.name+'" class="toggle toggle-round" type="checkbox" '+h+'><label for="toggle-'+f.name+'"></label></div></div></li>',$("#"+f.category+"-options").append(e),$("#toggle-"+f.name).change(c(f));g=a.blockstring.join(";"),g.length>0&&(g+=";"),$("#blockstring").val(g),$("#blockstring").bind("input propertychange",d)})})}()}({},function(){return this}());